<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Journal</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Sam Fraley</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Journal.html">Projects</a>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Journal</h1>

</div>


<pre class="r"><code>year.current = &#39;2023&#39;
quarter.current =&#39;1&#39;

#### LAUS for Philadelphia, Pennsylvania, and National ####
#Philadelphia LAUS
payload2 &lt;- list(&#39;seriesid&#39; = c(&#39;LAUCN421010000000003&#39;,
                                &#39;LAUCN421010000000004&#39;,
                                &#39;LAUCN421010000000005&#39;,
                                &#39;LAUCN421010000000006&#39;), 
                 &#39;startyear&#39;=&#39;2010&#39;, 
                 &#39;endyear&#39; = &#39;2030&#39;, 
                 &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)


LAUS2 &lt;- blsAPI(payload2, api_version = 2, return_data_frame = T)

LAUS.phl &lt;- LAUS2 %&gt;%
  pivot_wider(names_from = &#39;seriesID&#39;,
              values_from = &#39;value&#39;) %&gt;%
  rename(&#39;unemp.rate&#39; = &#39;LAUCN421010000000003&#39;,
         &#39;total.unemployed&#39; = &#39;LAUCN421010000000004&#39;,
         &#39;total.employed&#39; = &#39;LAUCN421010000000005&#39;,
         &#39;labor.force&#39; = &#39;LAUCN421010000000006&#39;) %&gt;%
  mutate(area = &quot;Philadelphia&quot;)



# LAUS for Pennsylvania 
payload2 &lt;- list(&#39;seriesid&#39; = c(&#39;LAUST420000000000003&#39;,
                                &#39;LAUST420000000000004&#39;,
                                &#39;LAUST420000000000005&#39;,
                                &#39;LAUST420000000000006&#39;), 
                 &#39;startyear&#39;=&#39;2010&#39;, 
                 &#39;endyear&#39; = &#39;2030&#39;, 
                 &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)
LAUS2 &lt;- blsAPI(payload2, api_version = 2, return_data_frame = T)

LAUS.pa &lt;- LAUS2 %&gt;%
  pivot_wider(names_from = &#39;seriesID&#39;,
              values_from = &#39;value&#39;) %&gt;%
  rename(&#39;unemp.rate&#39; = &#39;LAUST420000000000003&#39;,
         &#39;total.unemployed&#39; = &#39;LAUST420000000000004&#39;,
         &#39;total.employed&#39; = &#39;LAUST420000000000005&#39;,
         &#39;labor.force&#39; = &#39;LAUST420000000000006&#39;) %&gt;%
  mutate(area = &quot;Pennsylvania&quot;)


# National Employment 
payload2 &lt;- list(&#39;seriesid&#39; = c(&#39;LNU01000000&#39;,
                                &#39;LNU02000000&#39;,
                                &#39;LNU03000000&#39;,
                                &#39;LNU04000000&#39;), 
                 &#39;startyear&#39;=&#39;2010&#39;, 
                 &#39;endyear&#39; = &#39;2030&#39;, 
                 &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)
LAUS2 &lt;- blsAPI(payload2, api_version = 2, return_data_frame = T)

LAUS.us &lt;- LAUS2 %&gt;%
  pivot_wider(names_from = &#39;seriesID&#39;,
              values_from = &#39;value&#39;) %&gt;%
  rename(&#39;unemp.rate&#39; = &#39;LNU04000000&#39;,
         &#39;labor.force&#39; = &#39;LNU01000000&#39;,
         &#39;total.employed&#39; = &#39;LNU02000000&#39;,
         &#39;total.unemployed&#39; = &#39;LNU03000000&#39;) %&gt;%
  mutate(area = &quot;United States&quot;,
         labor.force = as.numeric(labor.force)*1000,
         total.employed = as.numeric(total.employed)*1000,
         total.unemployed = as.numeric(total.unemployed)*1000)

#Merging All Three Areas

LAUS &lt;- rbind(LAUS.phl,LAUS.pa,LAUS.us) %&gt;% 
  mutate(period = paste(periodName, year, sep=&quot; &quot;)) %&gt;%
  dplyr::select(!c(year, periodName))

#Converting to Long Format

LAUS_long &lt;- LAUS %&gt;% 
  pivot_longer(cols=unemp.rate:labor.force) %&gt;%
  mutate(date = parse_date_time(period, orders = &quot;my&quot;)) %&gt;%
  mutate(value = as.numeric(value))


#### LAUS Employment and Labor Force Charts ####
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)


LAUS_long %&gt;%
 subset(name %in% c(&quot;total.employed&quot;, &quot;total.unemployed&quot;)) %&gt;%
  subset(area == &quot;Philadelphia&quot;) %&gt;%
  ggplot(aes(x = date, y= value, 
             fill = factor(name, levels=c(&quot;total.unemployed&quot;,&quot;total.employed&quot;)))) +
  geom_area(color = &quot;white&quot;) +
  scale_y_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  coord_cartesian(ylim=c(500000,NA), expand = F) +
  scale_fill_manual(labels = c(&quot;Total Labor Force&quot;, &quot;Total Employment&quot;), values = c(&quot;#dbd7d1&quot;,&quot;#007abd&quot;)) +
  theme_classic() +
  scale_x_datetime(date_breaks = &quot;1 year&quot;, date_labels = &quot;%Y&quot;)+
  labs(x=NULL,y=&quot;Philadelphia Residents&quot;)+
  theme(legend.position=&quot;top&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(angle = 45, vjust = .5, size=10, color=&quot;black&quot;), 
        axis.title.y = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 20, b = 0, l = 0), size = 10, color=&quot;black&quot;),
        axis.text.y = element_text(size=10, color=&quot;black&quot;),
        legend.text = element_text(size=9, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid = element_blank()) </code></pre>
<p><img src="Journal_files/figure-html/cars-1.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 1 Employment and Labor Force.png&quot;,
         height=4, width = 7.5, units = &quot;in&quot;)

# Relative Employment Change
LAUS %&gt;%
  mutate(date = parse_date_time(LAUS$period, orders = &quot;my&quot;)) %&gt;%
  filter(date &gt;= &quot;2020-01-01&quot;) %&gt;%
  mutate(total.employed = as.numeric(total.employed)) %&gt;%
  arrange(date, date) %&gt;%
  group_by(area) %&gt;%
  mutate(change = (total.employed/first(total.employed) - 1)) %&gt;%
  ggplot(aes(x= date, y=change, 
             alpha = factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;)), 
             group = factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;)))) +
  geom_line(aes(color=factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;))),
            size=2) +
  scale_alpha_manual(values = c(1, .6,.5)) +
  scale_y_continuous(labels=percent_format(accuracy=1), breaks = seq(-1, 1, by = .02),
                     sec.axis = dup_axis())+
  scale_color_manual(values = c(&quot;#007abd&quot;,&quot;#005a8d&quot;,&quot;#47525f&quot;)) +
  theme_minimal() +
  scale_x_datetime(date_breaks = &quot;1 year&quot;, date_labels = &quot;%Y&quot;, expand = c(.05,0))+
  labs(x=NULL,y=&quot;Percent Change in Employment&quot;)+
  theme(legend.position=&quot;top&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(size=11, color=&quot;black&quot;), 
        axis.title.y = element_text(face=&quot;bold&quot;, size = 11, color=&quot;black&quot;),
        axis.text.y = element_text(size=11, color=&quot;black&quot;),
        legend.text = element_text(size=11, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_hline(aes(yintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-2.png" width="672" /></p>
<pre class="r"><code>ggplot2::ggsave(&quot;Figure 3 Relative Employment.png&quot;,
                height =4, width = 7.5, units = &quot;in&quot;)

           
# Unemployment Rate
LAUS %&gt;%
  mutate(date = parse_date_time(LAUS$period, orders = &quot;my&quot;)) %&gt;%
  filter(date &gt;= &quot;2019-01-01&quot;) %&gt;%
  mutate(unemp.rate = as.numeric(unemp.rate)) %&gt;%
  ggplot(aes(x=date, y=unemp.rate/100,
             alpha = factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;)), 
             group = factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;)))) +
  geom_line(aes(color=factor(area, levels = c(&quot;Philadelphia&quot;, &quot;Pennsylvania&quot;, &quot;United States&quot;))),
            size=2) +
  scale_alpha_manual(values = c(1, .6,.5)) +
  scale_y_continuous(labels=percent_format(accuracy=1), breaks = seq(-1, 1, by = .02),
                     sec.axis =  dup_axis())+
  scale_color_manual(values = c(&quot;#007abd&quot;,&quot;#172151&quot;,&quot;#47525f&quot;)) +
  coord_cartesian(ylim=c(0,NA)) +
  theme_minimal() +
  scale_x_datetime(date_breaks = &quot;1 year&quot;, date_labels = &quot;%Y&quot;) +
  labs(x=NULL,y=&quot;Unemployment Rate&quot;)+
  theme(legend.position=&quot;top&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(size=11, color=&quot;black&quot;), 
        axis.title.y = element_text(face=&quot;bold&quot;, size = 11, color=&quot;black&quot;),
        axis.text.y = element_text(size=11, color=&quot;black&quot;),
        legend.text = element_text(size=10, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_hline(yintercept = .06)</code></pre>
<p><img src="Journal_files/figure-html/cars-3.png" width="672" /></p>
<pre class="r"><code>ggplot2::ggsave(&quot;Figure 2 Unemployment Rate.png&quot;,
       height =5, width = 5, units = &quot;in&quot;)


#Getting Call Out Figures
unemp.rate &lt;- LAUS.phl %&gt;%
  head(n=1) %&gt;%
  dplyr::select(1:4)
feb2020.emp &lt;- LAUS.phl %&gt;% 
  mutate(period = paste(periodName, year, sep=&quot; &quot;)) %&gt;%
  dplyr::select(period, total.employed) %&gt;%
  subset(period == &quot;February 2020&quot;)
feb2020.lf &lt;- LAUS.phl %&gt;% 
  mutate(period = paste(periodName, year, sep=&quot; &quot;)) %&gt;%
  dplyr::select(period, labor.force) %&gt;%
  subset(period == &quot;February 2020&quot;)
emp.change &lt;- LAUS.phl %&gt;% 
  mutate(period = paste(periodName, year, sep=&quot; &quot;)) %&gt;%
  dplyr::select(period, total.employed) %&gt;% 
  head(n=1) %&gt;%
  mutate(period = &quot;Most Recent Month&quot;) %&gt;%
  rbind(feb2020.emp) %&gt;%
  pivot_wider(names_from = period, values_from = total.employed) %&gt;%
  mutate(`Change since Feb 2020` = as.numeric(`Most Recent Month`) - as.numeric(`February 2020`)) %&gt;%
  dplyr::select(`Change since Feb 2020`)
lf.change &lt;- LAUS.phl %&gt;% 
  mutate(period = paste(periodName, year, sep=&quot; &quot;)) %&gt;%
  dplyr::select(period, labor.force) %&gt;% 
  head(n=1) %&gt;%
  mutate(period = &quot;Most Recent Month&quot;) %&gt;%
  rbind(feb2020.lf) %&gt;%
  pivot_wider(names_from = period, values_from = labor.force) %&gt;%
  mutate(`Change since Feb 2020` = as.numeric(`Most Recent Month`) - as.numeric(`February 2020`)) %&gt;%
  dplyr::select(`Change since Feb 2020`)


#### LAUS for Comp Set ####

payload &lt;- list(&#39;seriesid&#39; = c(&#39;LAUMT423798000000005&#39;,
                               &#39;LAUMT363562000000005&#39;,
                               &#39;LAUMT114790000000005&#39;,
                               &#39;LAUMT171698000000005&#39;,
                               &#39;LAUMT241258000000005&#39;,
                               &#39;LAUMT257165000000005&#39;,
                               &#39;LAUMT063108000000005&#39;,
                               &#39;LAUMT482642000000005&#39;,
                               &#39;LAUMT131206000000005&#39;), 
                &#39;startyear&#39;=&#39;2020&#39;, 
                &#39;endyear&#39; = &#39;2030&#39;, 
                &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)


LAUS.comp &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(Month = my(paste(periodName, year, sep = &quot; &quot;))) %&gt;%
  mutate(City = case_when( seriesID == &#39;LAUMT423798000000005&#39; ~ &quot;Philadelphia&quot; ,
                           seriesID == &#39;LAUMT363562000000005&#39; ~ &quot;New York City&quot;,
                           seriesID == &#39;LAUMT114790000000005&#39; ~ &quot;Washington, DC&quot;,
                           seriesID == &#39;LAUMT171698000000005&#39; ~ &quot;Chicago&quot;,
                           seriesID == &#39;LAUMT241258000000005&#39; ~ &quot;Baltimore&quot;,
                           seriesID == &#39;LAUMT257165000000005&#39; ~ &quot;Boston&quot;,
                           seriesID == &#39;LAUMT063108000000005&#39; ~ &quot;Los Angeles&quot;,
                           seriesID == &#39;LAUMT482642000000005&#39; ~ &quot;Houston&quot;,
                           seriesID == &#39;LAUMT131206000000005&#39; ~ &quot;Atlanta&quot;))


LAUS.comp.12 &lt;- LAUS.comp %&gt;%
  dplyr::group_by(City) %&gt;%
  slice_max(Month, n=12) %&gt;%
  dplyr::select(City, Month, value) %&gt;%
  mutate(value = as.numeric(value)) %&gt;%
  pivot_wider(names_from = Month, values_from = value) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Year-Over-Year Change` = (.[[2]] - .[[13]])/.[[13]]) %&gt;%
  dplyr::select(City, `Year-Over-Year Change`)

LAUS.comp.recent &lt;- LAUS.comp %&gt;%
  dplyr::group_by(City) %&gt;%
  slice_max(Month, n=1) %&gt;%
  dplyr::select(City, Month, value) %&gt;%
  mutate(recent.emp = as.numeric(value)) 

LAUS.comp.recovery &lt;- LAUS.comp %&gt;%
  mutate(value = as.numeric(value)) %&gt;%
  dplyr::filter(Month == &quot;2020-02-01&quot;) %&gt;%
  mutate(Employment.Feb2020 = value) %&gt;%
  dplyr::select(City, Employment.Feb2020) %&gt;%
  left_join(LAUS.comp.recent) %&gt;%
  mutate(`Change Since February 2020` = (recent.emp - Employment.Feb2020)/Employment.Feb2020) %&gt;%
  dplyr::select(City, Month, `Change Since February 2020`) %&gt;%
  left_join(LAUS.comp.12)

rm(LAUS.comp, LAUS.comp.12, LAUS.comp.recent, payload)

LAUS.comp.recovery %&gt;%
  mutate(highlight = ifelse(City == &quot;Philadelphia&quot;, &quot;yes&quot;, &quot;no&quot;)) %&gt;%
  ggplot(aes(y=reorder(City, `Change Since February 2020`), x= `Change Since February 2020`, 
             fill = highlight, label =`Change Since February 2020`))+
  geom_col() +
  scale_fill_manual(values = c(&quot;yes&quot; = &quot;#007abd&quot;, &quot;no&quot; = &quot;#dbd7d1&quot;)) +
  theme_minimal() +
  scale_x_continuous(labels=percent_format(accuracy=1), breaks = seq(-1, 1, by = .01)) +
  labs(x=&quot;Percent Change in Employment&quot;, y=&quot;Metropolitan Statisitical Area&quot;)+
  theme(legend.position=&quot;none&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(vjust = .5, size=10, color=&quot;black&quot;), 
        axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.text.y = element_text(vjust = .5, size=10, color=&quot;black&quot;, face = &quot;bold&quot;), 
        legend.text = element_text(size=10, color=&quot;black&quot;),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-4.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 4 Comp Set Recovery Change.png&quot;,
       height=5, width = 5, units = &quot;in&quot;)


LAUS.comp.recovery %&gt;%
  mutate(highlight = ifelse(City == &quot;Philadelphia&quot;, &quot;yes&quot;, &quot;no&quot;)) %&gt;%
  ggplot(aes(y=reorder(City, `Year-Over-Year Change`), x= `Year-Over-Year Change`, fill = highlight))+
  geom_col() +
  scale_fill_manual(values = c(&quot;yes&quot; = &quot;#007abd&quot;, &quot;no&quot; = &quot;#dbd7d1&quot;)) +
  theme_minimal() +
  scale_x_continuous(labels=percent_format(accuracy=1), breaks = seq(-1, 1, by = .01)) +
  labs(x=&quot;Percent Change in Employment&quot;, y=&quot;Metropolitan Statisitical Area&quot;)+
  theme(legend.position=&quot;none&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(vjust = .5, size=10, color=&quot;black&quot;), 
        axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.text.y = element_text(vjust = .5, size=10, color=&quot;black&quot;, face = &quot;bold&quot;),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-5.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 5 Comp Set Year-Over-Year Change.png&quot;,
       height=5, width = 5, units = &quot;in&quot;)

#### Industry Employment for MSA ####
payload &lt;- list(
  &#39;seriesid&#39;=c(&#39;SMU42379800000000001&#39;, #Nonfarm Employment
               &#39;SMU42379801500000001&#39;, #Mining, Logging, and Construction
               &#39;SMU42379803000000001&#39;, #Manufacturing
               &#39;SMU42379804100000001&#39;, #Wholesale Trade
               &#39;SMU42379804200000001&#39;, #Retail Trade
               &#39;SMU42379804300000001&#39;, #Transportation and Utilities
               &#39;SMU42379805000000001&#39;, #Information
               &#39;SMU42379805552000001&#39;, #Finance and Insurance
               &#39;SMU42379806000000001&#39;, #Professional and Businees Services
               &#39;SMU42379806500000001&#39;, #Education and Health Services
               &#39;SMU42379807000000001&#39;  #Leisure and Hospitality
  ), 
  &#39;startyear&#39;=2015,
  &#39;endyear&#39;=2030, 
  &#39;registrationKey&#39; = &#39;160c8d9a0e7c40bcada565263a877b85&#39;)

ces.employment &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(Industry = case_when(seriesID ==  &#39;SMU42379800000000001&#39; ~ &quot;Nonfarm Employment&quot;,
                              seriesID == &#39;SMU42379801500000001&#39; ~ &quot;Mining, Logging, and Construction&quot;,
                              seriesID == &#39;SMU42379803000000001&#39; ~ &quot;Manufacturing&quot;,
                              seriesID == &#39;SMU42379804100000001&#39; ~ &quot;Wholesale Trade&quot;,
                              seriesID == &#39;SMU42379804200000001&#39; ~ &quot;Retail Trade&quot;,
                              seriesID == &#39;SMU42379804300000001&#39; ~ &quot;Transportation and Utilities&quot;,
                              seriesID == &#39;SMU42379805000000001&#39; ~ &quot;Information&quot;,
                              seriesID == &#39;SMU42379805552000001&#39; ~ &quot;Finance and Insurance&quot;,
                              seriesID == &#39;SMU42379806000000001&#39; ~ &quot;Professional and Business Services&quot;,
                              seriesID == &#39;SMU42379806500000001&#39; ~ &quot;Education and Health Services&quot;,
                              seriesID == &#39;SMU42379807000000001&#39;  ~ &quot;Leisure and Hospitality&quot;),
         Employment = as.numeric(value) * 1000) %&gt;%
  mutate(Month = my(paste(periodName, year, sep = &quot; &quot;))) 




most.recent.employment &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month) %&gt;%
  dplyr::select(Industry, Month, Employment)

month.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=2) %&gt;%
  dplyr::select(Industry, Month, Employment) %&gt;%
  pivot_wider(names_from = Month, values_from = Employment) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Month-Over-Month Change` = .[[2]] - .[[3]]) %&gt;%
  dplyr::select(Industry, `Month-Over-Month Change`)

year.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=12) %&gt;%
  dplyr::select(Industry, Month, Employment) %&gt;%
  pivot_wider(names_from = Month, values_from = Employment) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Year-Over-Year Change` = .[[2]] - .[[13]]) %&gt;%
  dplyr::select(Industry, `Year-Over-Year Change`)

pandemic.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  dplyr::filter(Month == &quot;2020-02-01&quot;) %&gt;%
  mutate(Employment.Feb2020 = Employment) %&gt;%
  dplyr::select(Industry, Employment.Feb2020) %&gt;%
  left_join(most.recent.employment) %&gt;%
  mutate(`Change Since February 2020` = Employment - Employment.Feb2020) %&gt;%
  dplyr::select(Industry, `Change Since February 2020`)

employment.summary &lt;- most.recent.employment %&gt;%
  left_join(month.change) %&gt;%
  left_join(year.change) %&gt;%
  left_join(pandemic.change) %&gt;%
  distinct() %&gt;%
  dplyr::select(!(Month))

rm(most.recent.employment, month.change, year.change, pandemic.change, payload)

employment.summary %&gt;%
  filter(Industry != &quot;Nonfarm Employment&quot;) %&gt;%
  arrange(desc(Employment)) %&gt;%
  ungroup() %&gt;%
  gt() %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(Employment, `Month-Over-Month Change`, `Year-Over-Year Change`, 
                                           `Change Since February 2020`))%&gt;%
  cols_align(align = &quot;left&quot;, columns = Industry) %&gt;%
  fmt_number(sep_mark = &quot;,&quot;, decimals = 0,
             columns = c(Employment, `Month-Over-Month Change`, `Year-Over-Year Change`, 
                                         `Change Since February 2020`)) %&gt;%
  tab_style(
    style = list(
      cell_fill(color = &quot;#007abd&quot;),
      cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Helvetica&quot;)),
    locations = list(cells_column_labels(columns = everything()))) %&gt;%
  tab_style(
    style=cell_text(font = &quot;Helvetica&quot;), 
    locations = cells_body(columns = everything())) %&gt;%
  tab_options(table.width = 1100) %&gt;%
  cols_width(c(Industry) ~ px(370)) %&gt;%
  tab_options(data_row.padding = px(10),
              column_labels.padding = px(15)) %&gt;%
  gtsave(&quot;Table 1 Regional Employment by Industry Sector.png&quot;, expand = 10, vheight=600, vwidth =1400)</code></pre>
<p><img src="Journal_files/figure-html/cars-6.png" width="672" /></p>
<pre class="r"><code>write_csv(employment.summary, &quot;Industry Employment Summary.csv&quot;)

#### Industry Employment for City ####
payload &lt;- list(
  &#39;seriesid&#39;=c(&#39;SMU42979610000000001&#39;, #Nonfarm Employment
               &#39;SMU42979611500000001&#39;, #Mining, Logging, and Construction
               &#39;SMU42979613000000001&#39;, #Manufacturing
               &#39;SMU42979614100000001&#39;, #Wholesale Trade
               &#39;SMU42979614200000001&#39;, #Retail Trade
               &#39;SMU42979614300000001&#39;, #Transportation and Utilities
               &#39;SMU42979615000000001&#39;, #Information
               &#39;SMU42979615500000001&#39;, #Finance and Insurance
               &#39;SMU42979616000000001&#39;, #Professional and Businees Services
               &#39;SMU42979616500000001&#39;, #Education and Health Services
               &#39;SMU42979617000000001&#39;  #Leisure and Hospitality
  ), 
  &#39;startyear&#39;=2015,
  &#39;endyear&#39;=2030, 
  &#39;registrationKey&#39; = &#39;160c8d9a0e7c40bcada565263a877b85&#39;)

ces.employment &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(Industry = case_when(seriesID ==  &#39;SMU42979610000000001&#39; ~ &quot;Nonfarm Employment&quot;,
                              seriesID == &#39;SMU42979611500000001&#39; ~ &quot;Mining, Logging, and Construction&quot;,
                              seriesID == &#39;SMU42979613000000001&#39; ~ &quot;Manufacturing&quot;,
                              seriesID == &#39;SMU42979614100000001&#39; ~ &quot;Wholesale Trade&quot;,
                              seriesID == &#39;SMU42979614200000001&#39; ~ &quot;Retail Trade&quot;,
                              seriesID == &#39;SMU42979614300000001&#39; ~ &quot;Transportation and Utilities&quot;,
                              seriesID == &#39;SMU42979615000000001&#39; ~ &quot;Information&quot;,
                              seriesID == &#39;SMU42979615500000001&#39; ~ &quot;Finance and Insurance&quot;,
                              seriesID == &#39;SMU42979616000000001&#39; ~ &quot;Professional and Business Services&quot;,
                              seriesID == &#39;SMU42979616500000001&#39; ~ &quot;Education and Health Services&quot;,
                              seriesID == &#39;SMU42979617000000001&#39;  ~ &quot;Leisure and Hospitality&quot;),
         Employment = as.numeric(value) * 1000) %&gt;%
  mutate(Month = my(paste(periodName, year, sep = &quot; &quot;))) 




most.recent.employment &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month) %&gt;%
  dplyr::select(Industry, Month, Employment)

month.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=2) %&gt;%
  dplyr::select(Industry, Month, Employment) %&gt;%
  pivot_wider(names_from = Month, values_from = Employment) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Month-Over-Month Change` = .[[2]] - .[[3]]) %&gt;%
  dplyr::select(Industry, `Month-Over-Month Change`)

year.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=12) %&gt;%
  dplyr::select(Industry, Month, Employment) %&gt;%
  pivot_wider(names_from = Month, values_from = Employment) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Year-Over-Year Change` = .[[2]] - .[[13]]) %&gt;%
  dplyr::select(Industry, `Year-Over-Year Change`)

pandemic.change &lt;- ces.employment %&gt;%
  dplyr::group_by(Industry) %&gt;%
  dplyr::filter(Month == &quot;2020-02-01&quot;) %&gt;%
  mutate(Employment.Feb2020 = Employment) %&gt;%
  dplyr::select(Industry, Employment.Feb2020) %&gt;%
  left_join(most.recent.employment) %&gt;%
  mutate(`Change Since February 2020` = Employment - Employment.Feb2020) %&gt;%
  dplyr::select(Industry, `Change Since February 2020`)

employment.summary &lt;- most.recent.employment %&gt;%
  left_join(month.change) %&gt;%
  left_join(year.change) %&gt;%
  left_join(pandemic.change) %&gt;%
  distinct() %&gt;%
  dplyr::select(!(Month))

rm(most.recent.employment, month.change, year.change, pandemic.change, payload)

employment.summary %&gt;%
  filter(Industry != &quot;Nonfarm Employment&quot;) %&gt;%
  arrange(desc(Employment)) %&gt;%
  ungroup() %&gt;%
  gt() %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(Employment, `Month-Over-Month Change`, `Year-Over-Year Change`, 
                                           `Change Since February 2020`))%&gt;%
  cols_align(align = &quot;left&quot;, columns = Industry) %&gt;%
  fmt_number(sep_mark = &quot;,&quot;, decimals = 0,
             columns = c(Employment, `Month-Over-Month Change`, `Year-Over-Year Change`, 
                         `Change Since February 2020`)) %&gt;%
  tab_style(
    style = list(
      cell_fill(color = &quot;#007abd&quot;),
      cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Helvetica&quot;)),
    locations = list(cells_column_labels(columns = everything()))) %&gt;%
  tab_style(
    style=cell_text(font = &quot;Helvetica&quot;), 
    locations = cells_body(columns = everything())) %&gt;%
  tab_options(table.width = 1100) %&gt;%
  cols_width(c(Industry) ~ px(370)) %&gt;%
  tab_options(data_row.padding = px(10),
              column_labels.padding = px(15)) %&gt;%
  gtsave(&quot;Table 1 City Employment by Industry Sector.png&quot;, expand = 10, vheight=600, vwidth =1400)</code></pre>
<p><img src="Journal_files/figure-html/cars-7.png" width="672" /></p>
<pre class="r"><code>write_csv(employment.summary, &quot;Industry Employment Summary.csv&quot;)

#### Wage Index ####
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)


payload &lt;- list(&#39;seriesid&#39; = c(&#39;CIU20200000000LJA&#39;,
                                &#39;CIU2020000000000A&#39;), 
                 &#39;startyear&#39;=&#39;2019&#39;, 
                 &#39;endyear&#39; = &#39;2030&#39;, 
                 &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)

wage.index.change &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(geography = ifelse(seriesID == &#39;CIU20200000000LJA&#39;, &quot;Philadelphia&quot;, &quot;United States&quot;),
         value = as.numeric(value) /100,
         quarter = paste0(substr(period,1,1), substr(period,3,3)),
         quarter1 = paste(year,substr(period,3,3), sep = &quot;.&quot;),
         quarter1 = as.numeric(quarter1),
         year = as.numeric(year)) %&gt;%
  slice_max(order_by = quarter1, n = 16)
  
  

wage.index.change %&gt;%
  ggplot(aes(x = quarter, y = value, fill = geography)) +
  geom_col(position = position_dodge(), color = &quot;white&quot;) +
  theme_minimal() +
  scale_fill_manual(values = c(&quot;#007abd&quot;, &quot;#002D46&quot;)) +
  scale_y_continuous(labels=percent_format(), expand = c(0,0), sec.axis = dup_axis())+
  labs(x=NULL,y=&quot;Year-Over-Year Change&quot;)+
  theme( 
    axis.text.x = element_text(size=10, color=&quot;black&quot;),     
    axis.title.y.left = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 20, b = 0, l = 0), size = 11, color=&quot;black&quot;),
    axis.title.y.right = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 0, b = 0, l = 20), size = 11, color=&quot;black&quot;),
    axis.text.y = element_text(size=11, color=&quot;black&quot;),
    legend.position = &quot;top&quot;,
    panel.grid = element_blank(),
    strip.placement = &quot;outside&quot;,
    legend.title = element_blank(),
    legend.text = element_text(size=10, color=&quot;black&quot;, face = &quot;bold&quot;),
    strip.text.x = element_text(size=11, color=&quot;black&quot;, face = &quot;bold&quot;)) +
  geom_hline(yintercept = 0, color = &quot;black&quot;, size = 1) +
  facet_grid(~year, 
             scales = &quot;free_x&quot;, 
             space = &quot;free_x&quot;, 
             switch = &quot;x&quot;)      </code></pre>
<p><img src="Journal_files/figure-html/cars-8.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 14 Wage Index.png&quot;,
       height=4.3, width = 5, units = &quot;in&quot;)



#### Inflation CPI ####
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)


payload &lt;- list(&#39;seriesid&#39; = c(&#39;CUUR0000SA0&#39;,
                               &#39;CUURS12BSA0&#39;), 
                &#39;startyear&#39;=&#39;2015&#39;, 
                &#39;endyear&#39; = &#39;2030&#39;, 
                &#39;registrationKey&#39;=&#39;3e5cdc72217947c09c3f6f8b939b1775&#39;)

cpi.inflation &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(geography = ifelse(seriesID == &#39;CUURS12BSA0&#39;, &quot;Philadelphia&quot;, &quot;United States&quot;)) %&gt;%
  dplyr::select(!(seriesID)) %&gt;%
  pivot_wider(names_from = geography, values_from = value) %&gt;%
  na.omit() %&gt;%
  mutate(period = paste(periodName, year, sep = &quot; &quot;), 
         period = as.Date(my(period))) %&gt;%
  pivot_longer(4:5, names_to = &quot;geography&quot;, values_to = &quot;value&quot;) %&gt;%
  mutate(value = as.numeric(value)) %&gt;%
  group_by(month=month(period, label = T), geography) %&gt;%
  arrange(period) %&gt;%
  mutate(yoy=value/lag(value,1)-1) %&gt;%
  group_by(geography) %&gt;%
  filter(period &gt;= &quot;2020-01-01&quot;)



cpi.inflation %&gt;%
  ggplot(aes(x = month, y = yoy, fill = geography)) +
  geom_col(position = position_dodge(), color = &quot;white&quot;) +
  theme_minimal() +
 scale_fill_manual(values = c(&quot;#007abd&quot;, &quot;#002D46&quot;)) +
  scale_y_continuous(labels=percent_format(), expand = c(0,0), sec.axis = dup_axis())+
  labs(x=NULL,y=&quot;Year-Over-Year Change&quot;)+
  theme( 
    axis.text.x = element_text(size=10, color=&quot;black&quot;),     
    axis.title.y.left = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 20, b = 0, l = 0), size = 11, color=&quot;black&quot;),
    axis.title.y.right = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 0, b = 0, l = 20), size = 11, color=&quot;black&quot;),
    axis.text.y = element_text(size=11, color=&quot;black&quot;),
    legend.position = &quot;top&quot;,
    panel.grid = element_blank(),
    strip.placement = &quot;outside&quot;,
    legend.title = element_blank(),
    legend.text = element_text(size=10, color=&quot;black&quot;, face = &quot;bold&quot;),
    strip.text.x = element_text(size=11, color=&quot;black&quot;, face = &quot;bold&quot;)) +
  geom_hline(yintercept = 0, color = &quot;black&quot;, size = 1) +
  facet_grid(~year, 
             scales = &quot;free_x&quot;, 
             space = &quot;free_x&quot;, 
             switch = &quot;x&quot;)      </code></pre>
<p><img src="Journal_files/figure-html/cars-9.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 15 Inflation.png&quot;,
       height=4, width = 8, units = &quot;in&quot;)



#### Removing Unnecessary Data ####
rm(ces.employment, employment.summary, feb2020.emp, feb2020.lf, LAUS, LAUS_long, LAUS.comp.recovery, 
   LAUS.pa, LAUS.phl, LAUS.us, LAUS2, payload, payload2, wage.index.change)

#### Pulling Data State CES Wages, YoY by industry####
payload &lt;- list(
  &#39;seriesid&#39;=c(&#39;SMU42000000500000003&#39;, #Private Employment
               &#39;SMU42000002000000003&#39;, #Mining, Logging, and Construction
               &#39;SMU42000003000000003&#39;, #Manufacturing
               &#39;SMU42000004000000003&#39;, #Trade and Transportation
               &#39;SMU42000005000000003&#39;, #Information
               &#39;SMU42000005500000003&#39;, #Finance and Insurance
               &#39;SMU42000006000000003&#39;, #Professional and Business Services
               &#39;SMU42000006500000003&#39;, #Education and Health Services
               &#39;SMU42000007000000003&#39;  #Leisure and Hospitality
  ), 
  &#39;startyear&#39;=2015,
  &#39;endyear&#39;=2030, 
  &#39;registrationKey&#39; = &#39;160c8d9a0e7c40bcada565263a877b85&#39;)

ces.wages &lt;- blsAPI(payload, api_version = 2, return_data_frame = T) %&gt;%
  mutate(Industry = case_when(seriesID == &#39;SMU42000000500000003&#39; ~ &quot;Private Employment&quot;,
                              seriesID == &#39;SMU42000002000000003&#39; ~ &quot;Mining, Logging, and Construction&quot;,
                              seriesID == &#39;SMU42000003000000003&#39; ~ &quot;Manufacturing&quot;,
                              seriesID == &#39;SMU42000004000000003&#39; ~ &quot;Trade and Transportation&quot;,
                              seriesID == &#39;SMU42000005000000003&#39; ~ &quot;Information&quot;,
                              seriesID == &#39;SMU42000005500000003&#39; ~ &quot;Finance and Insurance&quot;,
                              seriesID == &#39;SMU42000006000000003&#39; ~ &quot;Professional and Business Services&quot;,
                              seriesID == &#39;SMU42000006500000003&#39; ~ &quot;Education and Health Services&quot;,
                              seriesID == &#39;SMU42000007000000003&#39; ~ &quot;Leisure and Hospitality&quot;)) %&gt;%
  mutate(Month = my(paste(periodName, year, sep = &quot; &quot;))) %&gt;%
  rename(&quot;Wage&quot; = &quot;value&quot;) %&gt;%
  filter(Month != &quot;2023-01-01&quot;)


year.change.wages &lt;- ces.wages %&gt;%
  mutate(Wage = as.numeric(Wage))%&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=12) %&gt;%
  select(Industry, Month, Wage) %&gt;%
  pivot_wider(names_from = Month, values_from = Wage) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Year-Over-Year % Change` = (.[[2]] - .[[13]])/.[[13]],
         `Year-Over-Year Change` = (.[[2]] - .[[13]])) %&gt;%
  select(Industry, `Year-Over-Year % Change`, `Year-Over-Year Change`, 2) %&gt;%
  mutate(`Most Recent Average` = .[[4]]) %&gt;% select(!4)


last.month.wage.growth &lt;- ces.wages %&gt;%
  filter(Month != &quot;2022-12-01&quot;) %&gt;%
  mutate(Wage = as.numeric(Wage))%&gt;%
  dplyr::group_by(Industry) %&gt;%
  slice_max(Month, n=12) %&gt;%
  select(Industry, Month, Wage) %&gt;%
  pivot_wider(names_from = Month, values_from = Wage) %&gt;%
  dplyr::ungroup() %&gt;%
  mutate(`Nov Year-Over-Year % Change` = (.[[2]] - .[[13]])/.[[13]],
         `Nov Year-Over-Year Change` = (.[[2]] - .[[13]])) %&gt;%
  select(Industry, `Nov Year-Over-Year % Change`, `Nov Year-Over-Year Change`, 2) %&gt;%
  mutate(`Most Recent Average` = .[[4]]) %&gt;% select(!4)

wage.basispoint &lt;- last.month.wage.growth %&gt;%
  left_join(year.change.wages, by = c(&quot;Industry&quot;)) %&gt;%
  mutate(growth.perc.change = 100 * (`Year-Over-Year % Change` - `Nov Year-Over-Year % Change`),
         avg.change = (`Most Recent Average.y` - `Most Recent Average.x`))

setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)
year.change.wages %&gt;% 
  ggplot(aes(y=reorder(Industry, `Year-Over-Year % Change`), x= `Year-Over-Year % Change`))+
  geom_col(fill = &quot;#007abd&quot;) +
  theme_minimal() +
  scale_x_continuous(labels=percent_format(accuracy=1), breaks = seq(-1, 1, by = .01)) +
  labs(x=&quot;Year-Over-Year % Change&quot;, y=&quot;Broad Industry Sector&quot;)+
  theme(legend.position=&quot;none&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(vjust = .5, size=10, color=&quot;black&quot;), 
        axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.title.x = element_text(margin = margin(t = 20, r = 0, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.text.y = element_text(vjust = .5, size=10, color=&quot;black&quot;, face = &quot;bold&quot;), 
        legend.text = element_text(size=10, color=&quot;black&quot;),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-10.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 16 Year Over Year Wage Changes in PA.png&quot;,
       height=4.5, width = 9, units = &quot;in&quot;)
write.csv(year.change.wages, &quot;Year Change Wages Table.csv&quot;)
#### Burning Glass Charts ###
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Inputs&quot;)

bg.edu.exp &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 6) %&gt;%
  dplyr::select(!(7:8)) %&gt;%
  na.omit() %&gt;%
  pivot_longer(2:6) %&gt;%
  mutate(Education = name,
         `Job Postings` = round(value,-1),
         .keep = &quot;unused&quot;)
  
bg.edu.exp$Experience &lt;- dplyr::recode(bg.edu.exp$Experience,
         `0 to 2 years of experience` = &quot;Less than 3 Years&quot;, 
         `3 to 5 years of experience` = &quot;3 Years or More&quot;, 
         `6 to 8 years of experience` = &quot;3 Years or More&quot;,
         `9+ years of experience` = &quot;3 Years or More&quot;
  )

bg.edu.exp$Education &lt;- dplyr::recode(bg.edu.exp$Education,
                                      `Bachelor&#39;s degree` = &quot;Bachelor&#39;s Degree&quot;, 
                                      `High school or vocational training` = &quot;High School or Equivalent&quot;, 
                                      `Master&#39;s degree` = &quot;Master&#39;s Degree or Higher&quot;,
                                      `Associate&#39;s degree` = &quot;Associate&#39;s Degree&quot;,
                                     `Doctoral degree` = &quot;Master&#39;s Degree or Higher&quot;
)

bg.edu.exp &lt;- bg.edu.exp %&gt;%
  dplyr::group_by(Experience, Education) %&gt;%
  dplyr::summarize(`Job Postings` = sum(`Job Postings`))
  

bg.ind &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 8) %&gt;%
  slice_max(`Job Postings`, n=10) %&gt;%
  dplyr::select(1:3) %&gt;%
  mutate(`Job Postings` = round(`Job Postings`,-1),
         Industry = str_wrap(Industry, width = 50))

educ.req &lt;- read_csv(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Inputs\\Educ_BLS.csv&quot;)
educ.req$Education &lt;- factor(educ.req$Education, levels = c(&quot;No formal educational credential&quot;, 
                                                            &quot;High school diploma or equivalent&quot;,
                                                            &quot;Postsecondary nondegree award&quot;,
                                                            &quot;Associate&#39;s degree&quot;,
                                                            &quot;Bachelor&#39;s degree&quot;,
                                                            &quot;Master&#39;s degree&quot;,
                                                            &quot;Doctoral or professional degree&quot;))
bg.occ &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10) %&gt;%
  slice_max(`Job Postings`, n=10) %&gt;%
  dplyr::select(1:3) %&gt;%
  mutate(`Job Postings` = round(`Job Postings`,-1),
         Occupation = str_wrap(Occupation, width = 50)) %&gt;%
  stringdist_left_join(educ.req)

bg.occ.change.fast &lt;- readxl::read_excel(&quot;Burning Glass Extract - Last Year.xlsx&quot;, sheet = 10) %&gt;%
  left_join(readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10), 
            by = &quot;Occupation&quot;) %&gt;%
  filter(`Job Postings.x` &gt; 100) %&gt;%
  mutate(change = (`Job Postings.y` - `Job Postings.x`)/`Job Postings.y`) %&gt;%
  dplyr::select(Occupation, `Job Postings.x`, `Job Postings.y`, change) %&gt;%
  slice_max(order_by = change, n = 10)


bg.occ.change.dec.fast &lt;- readxl::read_excel(&quot;Burning Glass Extract - Last Year.xlsx&quot;, sheet = 10) %&gt;%
  left_join(readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10), 
            by = &quot;Occupation&quot;) %&gt;%
  filter(`Job Postings.x` &gt; 100) %&gt;%
  mutate(change = (`Job Postings.y` - `Job Postings.x`)/`Job Postings.y`) %&gt;%
  dplyr::select(Occupation,`Job Postings.x`,`Job Postings.y`, change) %&gt;%
  slice_max(order_by = -change, n = 10)


bg.occ.change.strong &lt;- readxl::read_excel(&quot;Burning Glass Extract - Last Year.xlsx&quot;, sheet = 10) %&gt;%
  left_join(readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10), 
            by = &quot;Occupation&quot;) %&gt;%
  mutate(change = `Job Postings.y` - `Job Postings.x`) %&gt;%
  dplyr::select(Occupation, change) %&gt;%
  slice_max(order_by = change, n = 10)

bg.occ.change.weak &lt;- readxl::read_excel(&quot;Burning Glass Extract - Last Year.xlsx&quot;, sheet = 10) %&gt;%
  left_join(readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10), 
            by = &quot;Occupation&quot;) %&gt;%
  mutate(change = `Job Postings.y` - `Job Postings.x`) %&gt;%
  dplyr::select(Occupation, change) %&gt;%
  slice_max(order_by = -change, n = 10)

bg.skill.level &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 10) %&gt;%
  dplyr::select(1:3) %&gt;%
  mutate(`Job Postings` = round(`Job Postings`,-1),
         Occupation = str_wrap(Occupation, width = 50)) %&gt;%
  stringdist_left_join(educ.req) %&gt;% select(3,6) %&gt;%
  dplyr::group_by(Skill) %&gt;%
  dplyr::summarize(total = sum(`Job Postings`))

bg.time &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 18) %&gt;%
  dplyr::select(1:2) %&gt;%
  mutate(`Job Postings` = round(`Total postings`,-1), .keep = &quot;unused&quot;) %&gt;%
  mutate(Period = parse_date_time(Period, orders = &quot;my&quot;),
         Year = year(Period),
         Month = month(Period, abbr = T, label = T)) %&gt;%
  slice_max(Period, n = 18) %&gt;%
  mutate(recent = rank(Period) %in% 16:18)

bg.time2 &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 18) %&gt;%
  dplyr::select(1:2) %&gt;%
  mutate(`Job Postings` = round(`Total postings`,-1), .keep = &quot;unused&quot;) %&gt;%
  mutate(Period = parse_date_time(Period, orders = &quot;my&quot;)) %&gt;%
  slice_max(Period, n = 24) %&gt;%
  mutate(recent = rank(Period) %in% 19:21)

bg.employers &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 4) %&gt;%
  dplyr::select(1:2) %&gt;%
  slice_max(`Job Postings`, n = 20) 

bg.certificate &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 2) %&gt;%
  dplyr::select(1:2) %&gt;%
  slice_max(`Job Postings`, n = 15) 

bg.skills &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 12) %&gt;%
  dplyr::select(1:5)
bg.software &lt;- readxl::read_excel(&quot;Burning Glass Extract.xlsx&quot;, sheet = 16) %&gt;%
  dplyr::select(1:5)
bg.skills &lt;- bg.skills %&gt;%
  rbind(bg.software) %&gt;% slice_max(`Skill Postings`, n = 7) %&gt;%
  dplyr::select(1)

bg.postings &lt;- bg.time %&gt;%
  subset(recent == TRUE) %&gt;%
  mutate(`Total Postings this Quarter` = sum(`Job Postings`)) %&gt;%
  dplyr::select(`Total Postings this Quarter`) %&gt;%
  head(n=1)

bg.previous &lt;- bg.time2 %&gt;%
  subset(recent == TRUE) %&gt;%
  mutate(`Total Postings last Quarter` = sum(`Job Postings`)) %&gt;%
  dplyr::select(`Total Postings last Quarter`) %&gt;%
  head(n=1) %&gt;%
  mutate(`Total Postings this Quarter` = bg.postings$`Total Postings this Quarter`) %&gt;%
  mutate(Change = `Total Postings this Quarter` - `Total Postings last Quarter`)
  

setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)

write.csv(bg.occ.change.fast, &quot;fastest_growing_occupations.csv&quot;)
write.csv(bg.occ.change.dec.fast, &quot;fastest_shrinking_occupations.csv&quot;)

bg.time %&gt;%
  ggplot(aes(x = Month, y = `Job Postings`, fill = recent)) +
  geom_col() +
  theme_minimal() +
  scale_fill_manual(values = c(&quot;#E7E6E6&quot;, &quot;#007abd&quot;)) +
  scale_y_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  labs(x=NULL,y=&quot;Monthly Job Postings&quot;)+
  theme( 
    axis.text.x = element_text(size=11, color=&quot;black&quot;, angle = 90, margin = margin(t=-5)), 
    strip.placement = &quot;outside&quot;,
    strip.text = element_text(face=&quot;bold&quot;, size = 11, color=&quot;black&quot;),
    axis.title.y = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 20, b = 0, l = 0), size = 11, color=&quot;black&quot;),
    axis.text.y = element_text(size=11, color=&quot;black&quot;),
    legend.position = &quot;none&quot;,
    panel.grid = element_blank()) +
  geom_hline(aes(yintercept = 0)) +
  facet_grid(~Year, 
             scales = &quot;free_x&quot;, 
             space = &quot;free_x&quot;, 
             switch = &quot;x&quot;)      </code></pre>
<p><img src="Journal_files/figure-html/cars-11.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 12 BG Time.png&quot;,
       height=4, width = 8, units = &quot;in&quot;)

bg.occ %&gt;%
  rename(&quot;Occupation&quot; = Occupation.x) %&gt;%
  ggplot(aes(x = `Job Postings`, y = reorder(Occupation, `Job Postings`), 
             fill = Education, 
             label = comma(`Job Postings`, accuracy = 1))) +
  geom_bar(stat=&quot;identity&quot;, width=.8) +
  scale_fill_manual(values = c(&quot;#a39d93&quot;, &quot;#172151&quot;, &quot;#005a8d&quot;, &quot;#007abd&quot;)) +
  scale_x_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6)) +
  theme_minimal() +
  labs(x=NULL,y=NULL)+
  theme(legend.position=c(.75,.15), legend.title=element_text(size=12, color=&quot;black&quot;, face=&quot;bold&quot;, margin = margin(b=3)), 
        axis.text.x = element_blank(), 
        legend.title.align = .9,
        legend.key.size = unit(.7,&quot;cm&quot;),
        axis.text.y = element_text(size=10, color=&quot;black&quot;, margin = margin(r =-5)),
        legend.text = element_text(size=10, color=&quot;black&quot;),
        panel.grid = element_blank()) +
  geom_text(position = position_dodge(0.9),
            hjust = 1.1, fontface=&quot;bold&quot;, color=&quot;white&quot;) +
  guides(fill = guide_legend(title = &quot;Typical Entry Level Education  &quot;,
                             label.position = &quot;right&quot;)) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-12.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 13 BG Occupations.png&quot;,
       height=4, width = 8, units = &quot;in&quot;)

bg.ind %&gt;%
  ggplot(aes(x = `Job Postings`, y = reorder(Industry, `Job Postings`), 
             label = comma(`Job Postings`))) +
  geom_col(fill = &quot;#007abd&quot;) +
  scale_x_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  theme_minimal() +
  labs(x=NULL,y=NULL)+
  theme(legend.position=&quot;bottom&quot;, legend.title=element_blank(), 
        axis.text.x = element_blank(), 
        axis.title.x = element_text(face=&quot;bold&quot;, margin = margin(t = 20, r = 0, b = 0, l = 0), size = 11, color=&quot;black&quot;),
        axis.text.y = element_text(size=11, color=&quot;black&quot;, face = &quot;bold&quot;, margin=margin(r=-10)),
        legend.text = element_text(size=11, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid = element_blank()) +
  geom_text(position = position_dodge(0.9),
            hjust = 1.1, fontface=&quot;bold&quot;, color=&quot;white&quot;) +
  guides(labels=guide_legend(reverse=T)) +
  guides(fill = guide_legend(reverse = T)) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-13.png" width="672" /></p>
<pre class="r"><code>bg.edu.exp %&gt;%
  ggplot(aes(y=reorder(Education, -`Job Postings`), x= `Job Postings`, fill = Experience, 
             label = ifelse(`Job Postings`&gt;=1500, comma(`Job Postings`), &quot;&quot;))) +
  geom_col(color=&quot;white&quot;, width=.75) +
  scale_x_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  scale_fill_manual(values = c(&quot;#e5b11b&quot;, &quot;#007abd&quot;)) +
  theme_minimal() +
  labs(x=NULL,y=NULL)+
  theme(legend.position=&quot;bottom&quot;, legend.title=element_text(size=12, color=&quot;black&quot;, face=&quot;bold&quot;, margin = margin(b=3)),
        axis.text.x = element_blank(), 
        axis.title.x = element_text(face=&quot;bold&quot;, margin = margin(t = 20, r = 0, b = 0, l = 0), size = 11, color=&quot;black&quot;),
        axis.text.y = element_text(size=11, color=&quot;black&quot;, face = &quot;bold&quot;),
        legend.text = element_text(size=11, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid = element_blank()) +
  geom_text(position = position_stack(vjust=.5), fontface=&quot;bold&quot;, color=&quot;white&quot;, size=5.5) +
  guides(labels=guide_legend(reverse=T)) +
  guides(fill = guide_legend(reverse = T)) +
  geom_vline(aes(xintercept = 0)) +
  guides(fill = guide_legend(title = &quot;Required Experience: &quot;)) </code></pre>
<p><img src="Journal_files/figure-html/cars-14.png" width="672" /></p>
<pre class="r"><code>rm(bg.edu.exp,
   bg.ind,
   bg.occ,
   bg.software,
   bg.time,
   bg.time2,
   educ.req
   )


#### Occupations ####
#install.packages(&quot;openxlsx&quot;)
library(openxlsx)
library(gt)

setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Inputs&quot;)
occs &lt;- openxlsx::read.xlsx (&quot;EMSI Occupations.xlsx&quot;, sheet = 3, sep.names = &quot; &quot;) %&gt;%
  mutate(`Median Hourly Earnings` = as.numeric(`Median Hourly Earnings`)) %&gt;%
  na.omit(`Median Hourly Earnings`)
  
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)

occs %&gt;%
  mutate(Employment = round(as.numeric(.[[4]]), -2),
         Annual.Emp.Change = round(as.numeric(.[[5]]), -1),
         Occupation = Description, 
         Wage = paste0(&quot;$&quot;, format(round(`Median Hourly Earnings`,2),nsmall=2))) %&gt;%
  slice_max(Employment, n=25) %&gt;%
  dplyr::select(Occupation, Employment, Annual.Emp.Change, Wage) %&gt;%
  rename(&quot;Occupation&quot; = Occupation,
         &quot;Total Employment&quot; = Employment,
         &quot;Employment Change&quot; = Annual.Emp.Change,
         &quot;Median Wage&quot; = Wage) %&gt;%
  gt() %&gt;%
  fmt_number(columns = c(`Total Employment`), decimals = 0) %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(`Median Wage`,`Employment Change`, `Total Employment`)) %&gt;%
  tab_style(
    style = list(
      cell_fill(color = &quot;#007abd&quot;),
      cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Arial&quot;)
    ),
    locations = cells_column_labels(columns = c(Occupation, 
                                                   `Median Wage`,`Employment Change`, `Total Employment`)))%&gt;%
  tab_style(
    style=cell_text(font = &quot;Arial&quot;), 
    locations = cells_body(columns = c(Occupation, `Median Wage`,`Employment Change`, `Total Employment`))) %&gt;%
  cols_width(c(`Occupation`) ~ px(450)) %&gt;%
    tab_options(
      column_labels.padding = 10,
      table.width = 1000
    ) %&gt;%
  gtsave(&quot;Appendix Table 5 Largest Occupations.png&quot;, expand = 10, vwidth=1200)</code></pre>
<p><img src="Journal_files/figure-html/cars-15.png" width="672" /></p>
<pre class="r"><code>occs %&gt;% 
  mutate(change = as.integer(.[[5]])) %&gt;%
  select(c(`Typical Entry Level Education`, change)) %&gt;%
  mutate(`Typical Entry Level Education` =  factor(`Typical Entry Level Education`, 
                                                   levels = c(&quot;No formal educational credential&quot;, 
                                        &quot;High school diploma or equivalent&quot;,
                                        &quot;Postsecondary nondegree award&quot;,
                                        &quot;Associate&#39;s degree&quot;,
                                        &quot;Bachelor&#39;s degree&quot;,
                                        &quot;Master&#39;s degree&quot;,
                                        &quot;Doctoral or professional degree&quot;))) %&gt;%
  na.omit() %&gt;%
  subset(`Typical Entry Level Education` != &quot;N/A&quot;) %&gt;%
  dplyr::group_by(`Typical Entry Level Education`) %&gt;%
  dplyr::summarize(change = sum(change))  %&gt;%
  ggplot(aes(y=reorder(`Typical Entry Level Education`, -change), x= change))+
  geom_col(color = &quot;white&quot;, fill = &quot;#005a8d&quot;) +
  theme_minimal() +
  scale_x_continuous(labels=comma_format(accuracy=1)) +
  labs(x=&quot;Change in Employment&quot;,y=&quot;Typical Entry Level Education&quot;)+
  theme(legend.position=&quot;bottom&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(vjust = .5, size=10, color=&quot;black&quot;, face = &quot;bold&quot;), 
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.text.y = element_text(size=10, color=&quot;black&quot;, face = &quot;bold&quot;),
        legend.text = element_text(size=10, color=&quot;black&quot;),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-16.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 11 Occupational Employment Change by Typical Degree Requirements in Philadelphia.png&quot;,
       height=4, width = 5, units = &quot;in&quot;)  


educ.occs &lt;- occs %&gt;% 
  mutate(change = as.integer(.[[5]])) %&gt;%
  select(c(`Typical Entry Level Education`, change)) %&gt;%
  mutate(`Typical Entry Level Education` =  factor(`Typical Entry Level Education`, 
                                                   levels = c(&quot;No formal educational credential&quot;, 
                                                              &quot;High school diploma or equivalent&quot;,
                                                              &quot;Postsecondary nondegree award&quot;,
                                                              &quot;Associate&#39;s degree&quot;,
                                                              &quot;Bachelor&#39;s degree&quot;,
                                                              &quot;Master&#39;s degree&quot;,
                                                              &quot;Doctoral or professional degree&quot;))) %&gt;%
  na.omit() %&gt;%
  subset(`Typical Entry Level Education` != &quot;N/A&quot;) %&gt;%
  dplyr::group_by(`Typical Entry Level Education`) %&gt;%
  dplyr::summarise(change=sum(change)) %&gt;%
  dplyr::mutate(share = change/sum(change))


occs %&gt;% 
  mutate(change = as.integer(.[[5]]),
         wage.groups = cut(as.numeric(`Median Hourly Earnings`), breaks = c(0,14,24,34,44,54,Inf), 
         labels = c(&quot;Less than $15&quot;, &quot;$15 to $24&quot;, &quot;$25 to $34&quot;, &quot;$35 to $44&quot;, &quot;$45 to $54&quot;, &quot;$55 and Higher&quot;))) %&gt;%
  select(c(`wage.groups`, change)) %&gt;%
  na.omit() %&gt;%
  dplyr::group_by(wage.groups) %&gt;%
  dplyr::summarize(change = sum(change)) %&gt;%
  ggplot(aes(y=wage.groups, x= change))+
  geom_col(color = &quot;white&quot;, fill = &quot;#005a8d&quot;) +
  coord_flip() +
  theme_minimal() +
  scale_x_continuous(labels=comma_format(accuracy=1)) +
  labs(x=&quot;Change in Employment&quot;,y=&quot;Median Hourly Wage&quot;)+
  theme(legend.position=&quot;bottom&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(vjust = 1, hjust = 1, size=10, color=&quot;black&quot;, angle = 45, face = &quot;bold&quot;), 
        axis.title.y = element_text(margin = margin(t = 0, r = 10, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.title.x = element_text(margin = margin(t = 10, r = 0, b = 0, l = 0), size = 10, color=&quot;black&quot;, face =&quot;bold&quot;),
        axis.text.y = element_text(size=10, color=&quot;black&quot;, face = &quot;bold&quot;),
        legend.text = element_text(size=10, color=&quot;black&quot;),
        panel.grid.major.y = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  geom_vline(aes(xintercept = 0))</code></pre>
<p><img src="Journal_files/figure-html/cars-17.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 10 Occupational Employment Change by Median Wage in Philadelphia.png&quot;,
       height=4, width = 5, units = &quot;in&quot;)

wage.occs &lt;- occs %&gt;% 
  mutate(change = as.integer(.[[5]]),
         wage.groups = cut(as.numeric(`Median Hourly Earnings`), breaks = c(0,14,24,34,44,54,Inf), 
                           labels = c(&quot;Less than $15&quot;, &quot;$15 to $24&quot;, &quot;$25 to $34&quot;, &quot;$35 to $44&quot;, &quot;$45 to $54&quot;, &quot;$55 and Higher&quot;))) %&gt;%
  select(c(`wage.groups`, change)) %&gt;%
  na.omit() %&gt;%
  dplyr::group_by(wage.groups) %&gt;%
  dplyr::summarize(change = sum(change)) %&gt;%
  dplyr::mutate(share = change/sum(change))

rm(educ.occs, occs, wage.occs)

#### UC Claims ####
setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Inputs&quot;)

onet &lt;- readxl::read_excel(&quot;Occupation Data.xlsx&quot;) 

uc.claims &lt;- readxl::read_excel(&quot;Philadelphia UC Claims.xlsx&quot;) %&gt;%
  mutate(`New Claimant Claim Date` = as.Date(`New Claimant Claim Date`))


claims.trend &lt;- uc.claims %&gt;%
  #mutate(`New Claimant Claim Date` = as.Date(`New Claimant Claim Date`)) %&gt;%
  filter(`New Claimant Claim Date` &gt;= floor_date(today(), unit = &quot;month&quot;) - months(25) &amp;
         uc.claims$`New Claimant Claim Date` &lt;= ceiling_date(today(), unit = &quot;month&quot;) - months(1)) %&gt;%
  mutate(year = year(`New Claimant Claim Date`),
         month = month(`New Claimant Claim Date`, abbr = T, label = T),
         period = my(paste(month, year, sep = &quot; &quot;))) %&gt;%
  group_by(year, month, period) %&gt;%
  summarize(claims = n_distinct(`Interface User ID`)) %&gt;%
  slice_max(order_by = period, n = 24)

claims.occupations &lt;- uc.claims %&gt;%
  #mutate(`New Claimant Claim Date` = as.Date(`New Claimant Claim Date`)) %&gt;%
  filter(`New Claimant Claim Date` &gt;= floor_date(today(), unit = &quot;month&quot;) - months(3) &amp;
          (`New Claimant Claim Date` &lt;= ceiling_date(today(), unit = &quot;month&quot;) - months(1))) %&gt;%
  group_by(`New Claimant Occupational Title`) %&gt;%
  summarize(claims = n_distinct(`Interface User ID`)) %&gt;%
  mutate(SOC = paste0(substr(`New Claimant Occupational Title`, 1,2), &quot;-&quot;,
                      substr(`New Claimant Occupational Title`, 3,6))) %&gt;%
  left_join(onet) %&gt;%
  na.omit(`Occupational Title`) %&gt;%
  group_by(`Occupational Title`) %&gt;%
  summarize(claims = sum(claims)) %&gt;%
  slice_max(claims, n = 15)

claims.employers &lt;- uc.claims %&gt;%
 # mutate(`New Claimant Claim Date` = as.Date(`New Claimant Claim Date`)) %&gt;%
  filter(`New Claimant Claim Date` &gt;= floor_date(today(), unit = &quot;month&quot;) - months(3) &amp;
           `New Claimant Claim Date` &lt;= ceiling_date(today(), unit = &quot;month&quot;) - months(1)) %&gt;%
  mutate(`Interface Employer Name` = stringr::str_to_upper(`Interface Employer Name`)) %&gt;%
  group_by(`Interface Employer Name`) %&gt;%
  summarize(claims = n_distinct(`Interface User ID`)) %&gt;%
  na.omit(`Interface Employer Name`) %&gt;%
  slice_max(claims, n = 10)

education &lt;- readxl::read_excel(&quot;education.xlsx&quot;)

claims.education &lt;- uc.claims %&gt;%
  filter(`New Claimant Claim Date` &gt;= floor_date(today(), unit = &quot;month&quot;) - months(3) &amp;
           `New Claimant Claim Date` &lt;= ceiling_date(today(), unit = &quot;month&quot;) - months(1)) %&gt;%
  left_join(education, by = &quot;Interface Degree Code&quot;) %&gt;%
  group_by(`Educational Attainment`) %&gt;%
  summarize(claims = n_distinct(`Interface User ID`)) %&gt;%
  mutate(`Educational Attainment` = replace_na(`Educational Attainment`, &quot;Not Reported&quot;),
         `Educational Attainment` = str_wrap(`Educational Attainment`,10))



setwd(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Outputs&quot;)

claims.trend %&gt;%
  ggplot(aes(x = month, y = claims)) +
  geom_col(fill = &quot;#007abd&quot;) +
  theme_minimal() +
  #scale_fill_manual(values = &quot;#007abd&quot;) +
  scale_y_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  labs(x=NULL,y=&quot;New Initial Claims&quot;)+
  theme( 
    axis.text.x = element_text(size=11, color=&quot;black&quot;, angle = 90, vjust = .5, hjust = 1, margin = margin(t=-5, b = 10)), 
    axis.title.y = element_text(face=&quot;bold&quot;, margin = margin(t = 0, r = 20, b = 0, l = 0), size = 11, color=&quot;black&quot;),
    axis.text.y = element_text(size=11, color=&quot;black&quot;),
    legend.position = &quot;none&quot;,
    axis.line.y = element_line(),
    strip.placement = &quot;outside&quot;,
    strip.text = element_text(face=&quot;bold&quot;, size = 11, color=&quot;black&quot;),
    panel.grid.major.y = element_line(color = &quot;grey90&quot;),
    panel.grid.minor.y = element_line(color = &quot;grey95&quot;),
    panel.grid = element_blank()) +
  #scale_x_date(date_labels = &quot;%b %Y&quot;, breaks = &quot;1 month&quot;, expand = c(0.01,0.01)) +
  geom_hline(aes(yintercept = 0)) +
  facet_grid(~year, 
             scales = &quot;free_x&quot;, 
             space = &quot;free_x&quot;, 
             switch = &quot;x&quot;)      </code></pre>
<p><img src="Journal_files/figure-html/cars-18.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 7 Claims Trend.png&quot;,
       height=3.5, width = 8, units = &quot;in&quot;)


claims.education %&gt;%
  ggplot(aes(x = `claims`, y = reorder(`Educational Attainment`, claims),
             label = comma(`claims`, accuracy = 1)))+
  geom_col(fill = &quot;#005A8D&quot;, width=0.75) +
  scale_x_continuous(labels=comma_format(accuracy=1), breaks=scales::pretty_breaks(n = 6))+
  theme_minimal() +
  labs(x=NULL,y=NULL)+
  theme(legend.position=&quot;bottom&quot;, legend.title=element_blank(), 
        axis.text.x = element_text(size=10, color=&quot;black&quot;),
        axis.text.y = element_text(size=10, color=&quot;black&quot;, margin=margin(r= -5)),
        legend.text = element_text(size=10, color=&quot;black&quot;, face=&quot;bold&quot;),
        panel.grid = element_blank(),
        panel.grid.major.x = element_line(color = &quot;grey90&quot;),
        panel.grid.minor.x = element_line(color = &quot;grey95&quot;)) +
  guides(labels=guide_legend(reverse=T)) +
  guides(fill = guide_legend(reverse = T)) +
  geom_vline(aes(xintercept = 0), lwd = 1 )</code></pre>
<p><img src="Journal_files/figure-html/cars-19.png" width="672" /></p>
<pre class="r"><code>ggsave(&quot;Figure 6 UC Education.png&quot;,
       height=5, width = 4.8, units = &quot;in&quot;)


claims.counts &lt;- claims.trend %&gt;%
  ungroup() %&gt;%
  slice_max(order_by = period, n = 3) %&gt;%
  summarize(total = sum(claims))
  

rm(claims.education, claims.trend, education, uc.claims)

#### Getting 3 Digit QCEW Data and Making Tables ####
naics.codes &lt;- read_csv(&quot;A:\\LMI Reporting\\Quarterly LMI Report\\Data and Charts\\ggplot Inputs\\NAICScodes.csv&quot;)

QCEW3digit &lt;- blsQCEW(&#39;Area&#39;, year = 2022, quarter = 2, area=&#39;42101&#39;) %&gt;% 
  subset(agglvl_code == 75 &amp; own_code == 5 &amp; disclosure_code != &quot;N&quot; &amp; oty_disclosure_code != &quot;N&quot;) %&gt;%
  rename(Year = year,
         Employment = month3_emplvl,
         LQ = lq_month3_emplvl,
         Annual.Est.Change = oty_qtrly_estabs_chg,
         Annual.Emp.Pct.Change = oty_month3_emplvl_pct_chg,
         Annual.Emp.Change = oty_month3_emplvl_chg) %&gt;%
  mutate(Aggregation = &quot;Three-Digit&quot;) %&gt;%
  left_join(naics.codes, by = c(&quot;industry_code&quot; = &quot;code&quot;))

#Top Employment Growth Table
QCEW3digit %&gt;%
  slice_max(Annual.Emp.Change, n=10) %&gt;%
  filter(Annual.Emp.Change &gt; 0) %&gt;%
  dplyr::select(industry_code, title, Annual.Est.Change, Annual.Emp.Change, Annual.Emp.Pct.Change) %&gt;%
  mutate(Annual.Emp.Change = paste0(&quot;+&quot;, prettyNum(Annual.Emp.Change,big.mark=&quot;,&quot;))) %&gt;%
  mutate(Annual.Emp.Pct.Change = percent(Annual.Emp.Pct.Change/100,accuracy = .1, big.mark = &quot;,&quot;)) %&gt;%
  rename(&quot;Industry Title&quot; = title,
         &quot;Establishment Change&quot; = Annual.Est.Change, 
         &quot;Employment Change&quot; = Annual.Emp.Change,
         &quot;NAICS&quot; = industry_code,
         &quot;Employment Percent Change&quot; = Annual.Emp.Pct.Change) %&gt;%
  gt() %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(NAICS,`Employment Change`,`Employment Percent Change`, `Establishment Change`))  %&gt;%
  tab_style(
    style = list(cell_fill(color = &quot;#007abd&quot;), cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Arial&quot;)),
    locations = cells_column_labels(columns = c(NAICS,`Industry Title`, `Employment Change`, `Employment Percent Change`, `Establishment Change`)))  %&gt;%
tab_style(
    style=cell_text(font = &quot;Arial&quot;), 
    locations = cells_body(columns = c(NAICS,`Industry Title`, `Employment Change`, `Employment Percent Change`, `Establishment Change`))) %&gt;%
  tab_options(
    column_labels.padding = 10,
    table.width = 1000
  ) %&gt;%
  cols_width(c(`Industry Title`) ~ px(450)) %&gt;%
  gtsave(&quot;Appendix Table 3 Top Employment Growth.png&quot;, expand = 10, vwidth =1100)</code></pre>
<p><img src="Journal_files/figure-html/cars-20.png" width="672" /></p>
<pre class="r"><code>## Top Employment Decline Table
QCEW3digit %&gt;%
  slice_min(Annual.Emp.Change, n=10) %&gt;%
  filter(Annual.Emp.Change &lt; 0) %&gt;%
  dplyr::select(industry_code, title, Annual.Est.Change, Annual.Emp.Change, Annual.Emp.Pct.Change) %&gt;%
  mutate(Annual.Emp.Change = prettyNum(Annual.Emp.Change,big.mark=&quot;,&quot;)) %&gt;%
  mutate(Annual.Emp.Pct.Change = percent(Annual.Emp.Pct.Change/100,accuracy = .1, big.mark = &quot;,&quot;)) %&gt;%
  rename(&quot;Industry Title&quot; = title,
         &quot;Establishment Change&quot; = Annual.Est.Change, 
         &quot;Employment Change&quot; = Annual.Emp.Change,
         &quot;NAICS&quot; = industry_code,
         &quot;Employment Percent Change&quot; = Annual.Emp.Pct.Change) %&gt;%
  gt() %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(NAICS,`Employment Change`,`Employment Percent Change`, `Establishment Change`))  %&gt;%
  tab_style(
    style = list(cell_fill(color = &quot;#007abd&quot;), cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Arial&quot;)),
    locations = cells_column_labels(columns = c(NAICS,`Industry Title`, `Employment Change`, `Employment Percent Change`, `Establishment Change`)))  %&gt;%
  tab_style(
    style=cell_text(font = &quot;Arial&quot;), 
    locations = cells_body(columns = c(NAICS,`Industry Title`, `Employment Change`, `Employment Percent Change`, `Establishment Change`))) %&gt;%
  tab_options(
    column_labels.padding = 10,
    table.width = 1000
  ) %&gt;%
  cols_width(c(`Industry Title`) ~ px(450)) %&gt;%
  gtsave(&quot;Appendix Table 4 Top Employment Decline.png&quot;, expand = 10, vwidth =1100)</code></pre>
<p><img src="Journal_files/figure-html/cars-21.png" width="672" /></p>
<pre class="r"><code>## Largest Industries
QCEW3digit %&gt;%
  mutate(Employment = round(Employment, -2),
         Annual.Emp.Change = round(Annual.Emp.Change,-1)) %&gt;%
  slice_max(Employment, n=15) %&gt;%
  dplyr::select(industry_code,title, Employment, qtrly_estabs, LQ) %&gt;%
  mutate(qtrly_estabs = prettyNum(qtrly_estabs, big.mark = &quot;,&quot;)) %&gt;%
  rename(&quot;Industry Title&quot; = title,
         &quot;Establishments&quot; = qtrly_estabs,
         &quot;Total Employment&quot; = Employment,
         &quot;Location Quotient&quot; = LQ,
         &quot;NAICS&quot; = industry_code) %&gt;%
  gt() %&gt;%
  fmt_number(columns = c(`Total Employment`), decimals = 0) %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(NAICS, `Total Employment`, `Location Quotient`, `Establishments`)) %&gt;%
  tab_style(
    style = list(
      cell_fill(color = &quot;#007abd&quot;),
      cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Arial&quot;)
    ),
    locations = cells_column_labels(columns = c(NAICS,`Industry Title`, `Total Employment`, `Location Quotient`, `Establishments`))
  ) %&gt;%
  tab_style(
    style=cell_text(font = &quot;Arial&quot;), 
    locations = cells_body(columns = c(NAICS,`Industry Title`, `Total Employment`, `Location Quotient`, `Establishments`))) %&gt;%
  cols_width(c(`Industry Title`) ~ px(450)) %&gt;%
  tab_options(
    column_labels.padding = 10,
    table.width = 1100
  ) %&gt;%
  gtsave(&quot;Appendix Table 1 Largest Industries.png&quot;, expand = 10, vwidth=1200)</code></pre>
<p><img src="Journal_files/figure-html/cars-22.png" width="672" /></p>
<pre class="r"><code>## Top Specialized Industries
QCEW3digit %&gt;%
  mutate(Employment = round(Employment, -2),
         Annual.Emp.Change = round(Annual.Emp.Change,-1)) %&gt;%
  slice_max(LQ, n=10) %&gt;%
  dplyr::select(industry_code,title, Employment, qtrly_estabs, LQ) %&gt;%
  mutate(qtrly_estabs = prettyNum(qtrly_estabs, big.mark = &quot;,&quot;)) %&gt;%
  rename(&quot;Industry Title&quot; = title,
         &quot;Establishments&quot; = qtrly_estabs,
         &quot;Total Employment&quot; = Employment,
         &quot;Location Quotient&quot; = LQ,
         &quot;NAICS&quot; = industry_code) %&gt;%
  gt() %&gt;%
  fmt_number(columns = c(`Total Employment`), decimals = 0) %&gt;%
  cols_align(align = &quot;center&quot;, columns = c(NAICS, `Total Employment`, `Location Quotient`, `Establishments`)) %&gt;%
  tab_style(
    style = list(
      cell_fill(color = &quot;#007abd&quot;),
      cell_text(weight = &quot;bold&quot;, color=&quot;white&quot;, font = &quot;Arial&quot;)
    ),
    locations = cells_column_labels(columns = c(NAICS,`Industry Title`, `Total Employment`, `Location Quotient`, `Establishments`))
  ) %&gt;%
  tab_style(
    style=cell_text(font = &quot;Arial&quot;), 
    locations = cells_body(columns = c(NAICS,`Industry Title`, `Total Employment`, `Location Quotient`, `Establishments`))) %&gt;%
  cols_width(c(`Industry Title`) ~ px(450)) %&gt;%
  tab_options(
    column_labels.padding = 10,
    table.width = 1100
  ) %&gt;%
  gtsave(&quot;Appendix Table 2 Specialized Industries.png&quot;, expand = 10, vwidth=1200)</code></pre>
<p><img src="Journal_files/figure-html/cars-23.png" width="672" /></p>
<pre class="r"><code>#Removing Unnecessary Data
rm(naics.codes, onet, QCEW.Previous, QCEW3digit, quarter.current, quarter.previous, year.current, year.previous)



#### END ####</code></pre>
<div id="including-plots" class="section level2">
<h2>Including Plots</h2>
<p>You can also embed plots, for example:</p>
<p><img src="Journal_files/figure-html/pressure-1.png" width="672" /></p>
<p>Note that the <code>echo = FALSE</code> parameter was added to the code chunk to prevent printing of the R code that generated the plot.</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
